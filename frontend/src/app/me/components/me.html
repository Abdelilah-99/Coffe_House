<div class="profle-container container-fluid">
    <!-- Profile Header -->
    <div class="profile-header">
        <div *ngIf="isLoading" class="loading">
            loading...
        </div>
        <div *ngIf="userProfile" class="profile-info row">
            <div class="profile-avatar col-12 col-md-auto d-flex justify-content-center justify-content-md-start">
                <img *ngIf="userProfile.profileImagePath"
                    [src]="'http://localhost:8080/' + userProfile.profileImagePath" alt="Profile Picture">
                <div *ngIf="!userProfile.profileImagePath" class="avatar-placeholder">
                    {{userProfile.firstName.charAt(0)}}{{userProfile.lastName.charAt(0)}}
                </div>
            </div>
            <div class="profile-details col-12 col-md text-center text-md-start">
                <h1>{{userProfile.firstName}} {{userProfile.lastName}}</h1>
                <p class="username">&#64;{{userProfile.username}}</p>
                <p class="email">{{userProfile.email}}</p>
            </div>
        </div>
        <div *ngIf="!isLoading && !userProfile" class="no-data">
            <p>No profile data available</p>
        </div>
    </div>

    <!-- Post Creation Form -->
    <div class="create-post-section">
        <div class="create-post-header">
            <div class="header-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                    <path
                        d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
                    <path fill-rule="evenodd"
                        d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z" />
                </svg>
            </div>
            <div class="header-text">
                <h2>Create New Post</h2>
                <p>Share your thoughts with the community</p>
            </div>
        </div>
        <form (ngSubmit)="onCreatePost()" class="create-post-form">
            <div class="form-group title-group">
                <div class="title-input-wrapper">
                    <input id="post-title" [(ngModel)]="post.title" name="title" maxlength="200" type="text"
                        class="title-input" placeholder="Enter your story title..." required>
                    <div class="title-underline"></div>
                </div>
                <div class="title-hint">
                    <span class="char-count">{{ (post.title.length || 0) }}/200</span>
                </div>
            </div>
            <div class="form-group">
                <label for="post-content text-break">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path
                            d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0m4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0m3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2" />
                        <path
                            d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9 9 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.4 10.4 0 0 1-.524 2.318l-.003.011a11 11 0 0 1-.244.637c-.079.186.074.394.273.362a22 22 0 0 0 .693-.125m.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6-3.004 6-7 6a8 8 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a11 11 0 0 0 .398-2" />
                    </svg>
                    Content
                </label>
                <textarea id="post-content" maxlength="10000" [(ngModel)]="post.content" name="content" rows="6"
                    placeholder="What's on your mind? Share your story..." required></textarea>
                <div class="content-hint">
                    <span class="char-count">{{ (post.content.length || 0) }}/10000</span>
                </div>
            </div>
            <div *ngIf="selectedFiles.length > 0" class="image-preview-container">
                <div *ngFor="let file of previewUrls; let   i = index" class="image-preview-item">
                    <img *ngIf="file.type.startsWith('image/')" [src]="file.url" alt="Preview">
                    <video *ngIf="file.type.startsWith('video/')" [src]="file.url" alt="Preview" controls></video>
                    <button type="button" class="remove-image-btn" (click)="deleteFileSelected(i)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293z" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="form-actions">
                <div class="file-input-wrapper">
                    <label for="file-input" class="file-input-label">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0" />
                            <path
                                d="M2.002 1a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V3a2 2 0 0 0-2-2zm12 1a1 1 0 0 1 1 1v6.5l-3.777-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12V3a1 1 0 0 1 1-1z" />
                        </svg>
                        <span>Add Photos</span>
                    </label>
                    <input id="file-input" type="file" (change)="onFileSelected($event)" multiple>
                    <span *ngIf="selectedFiles.length > 0" class="file-count">{{selectedFiles.length}}
                        photo(s)/video(s)</span>
                </div>
                <button type="submit" class="submit-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path
                            d="M15.964.686a.5.5 0 0 0-.65-.65L.767 5.855H.766l-.452.18a.5.5 0 0 0-.082.887l.41.26.001.002 4.995 3.178 3.178 4.995.002.002.26.41a.5.5 0 0 0 .886-.083zm-1.833 1.89L6.637 10.07l-.215-.338a.5.5 0 0 0-.154-.154l-.338-.215 7.494-7.494 1.178-.471z" />
                    </svg>
                    Publish Post
                </button>
            </div>
        </form>
    </div>

    <!-- User Posts Section -->
    <div class="user-posts-section">
        <h2>My Posts</h2>
        <div *ngIf="isLoadingPosts" class="loading">
            Loading posts...
        </div>
        <div *ngIf="!isLoadingPosts && userPosts.length === 0" class="no-posts">
            <p>No posts yet. Create your first post!</p>
        </div>
        <div *ngIf="!isLoadingPosts && userPosts.length > 0">
            <div class="row g-4">
                <div *ngFor="let post of userPosts" class="col-12 col-sm-6 col-md-4 col-lg-3">
                    <div class="post-card" (click)="navigateToPost(post.postUuid)">
                        <!-- Post with image(s) - Image as background with overlay -->
                        <div *ngIf="post.mediaPaths && post.mediaPaths.length > 0" class="post-with-image">
                            <div class="post-image-wrapper">
                                <img *ngIf="post.mediaPaths[0].type.startsWith('image')"
                                    [src]="'http://localhost:8080/' + post.mediaPaths[0].path" alt="{{ post.title }}"
                                    class="post-bg-image">
                                <video *ngIf="post.mediaPaths[0].type.startsWith('video')"
                                    [src]="'http://localhost:8080/' + post.mediaPaths[0].path"></video>
                                <div class="post-image-overlay">
                                    <h3 class="post-title-overlay text-break">{{post.title}}</h3>
                                </div>
                            </div>
                            <div class="py-3 px-4 bg-body">
                                <div class="post-author-compact">
                                    <div class="author-avatar-small">
                                        <img *ngIf="userProfile?.profileImagePath"
                                            [src]="'http://localhost:8080/' + userProfile?.profileImagePath"
                                            alt="Profile">
                                        <div *ngIf="!userProfile?.profileImagePath" class="avatar-placeholder-small">
                                            {{userProfile?.firstName?.charAt(0) || ''}}
                                        </div>
                                    </div>
                                    <span class="author-name">{{post.userName}}</span>
                                    <span class="post-time">{{post.createdAt | date: 'short'}}</span>
                                </div>
                                <div class="post-actions" (click)="$event.stopPropagation()">
                                    <button class="action-btn like-btn" (click)="handleLike($event, post.postUuid)">
                                        <img src="/coffe-like.png" alt="Like" class="icon">
                                        <div class="like-count">
                                            <span>{{post.likeCount}}</span>
                                        </div>
                                    </button>
                                    <button class="action-btn comment-btn" (click)="navigateToPost(post.postUuid)">
                                        <img src="/coffe-comment.png" alt="Comment" class="icon">
                                        <span class="count">{{post.commentCount}}</span>
                                        <span class="text">Comments</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Post without image - Traditional layout -->
                        <div *ngIf="!post.mediaPaths || post.mediaPaths.length === 0" class="post-no-image">
                            <div class="post-header">
                                <div class="post-author">
                                    <div class="author-avatar-small">
                                        <img *ngIf="userProfile?.profileImagePath"
                                            [src]="'http://localhost:8080/' + userProfile?.profileImagePath"
                                            alt="Profile">
                                        <div *ngIf="!userProfile?.profileImagePath" class="avatar-placeholder-small">
                                            {{userProfile?.firstName?.charAt(0) || ''}}
                                        </div>
                                    </div>
                                    <div class="author-info">
                                        <span class="author-name">{{post.userName}}</span>
                                        <span class="post-time">{{post.createdAt | date: 'short'}}</span>
                                    </div>
                                </div>
                            </div>

                            <div class="post-content text-break">
                                <h3>{{post.title}}</h3>
                                <p class="post-preview text-break">{{post.content}}...</p>
                            </div>

                            <div class="post-actions" (click)="$event.stopPropagation()">
                                <button class="action-btn like-btn" (click)="handleLike($event, post.postUuid)">
                                    <img src="/coffe-like.png" alt="Like" class="icon">
                                    <div class="like-count">
                                        <span class="count">{{post.likeCount}}</span>
                                    </div>
                                </button>
                                <button class="action-btn comment-btn" (click)="navigateToPost(post.postUuid)">
                                    <img src="/coffe-comment.png" alt="Comment" class="icon">
                                    <div class="comment-count">
                                        <span class="count">{{post.commentCount}}</span>
                                    </div>
                                    <span class="text">Comments</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div #anchor class="loading-trigger"></div>
</div>