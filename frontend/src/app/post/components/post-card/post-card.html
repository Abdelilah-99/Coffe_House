<div *ngIf="post && profileData" class="col-12 col-lg-8 mx-auto mb-4">

    <div class="post-card">
        <div class="post-header">
            <div class="post-author-info">
                <div class="author-avatar" (click)="moveToProfile(post.userUuid)">
                    <img *ngIf="post.profileImagePath" [src]="'http://localhost:8080/' + post.profileImagePath"
                        alt="{{ post.userName }}" class="author-avatar-img">
                    <div *ngIf="!post.profileImagePath" class="author-avatar-placeholder">
                        {{ post.userName.charAt(0).toUpperCase() || '?' }}
                    </div>
                </div>
                <div class="author-details">
                    <div class="username-row">
                        <span class="post-username">@{{ post.userName }}</span>
                    </div>
                    <span class="post-createdAt">{{ post.createdAt | date: 'short' }}</span>
                </div>
            </div>
        </div>
        <h2 class="post-title">{{ post.title }}</h2>
        <p class="post-content">{{ post.content }}</p>
        <div class="post-images" *ngIf="post.mediaPaths && post.mediaPaths.length > 0">
            <div *ngFor="let media of post.mediaPaths">
                <img *ngIf="isImage(media.type)" [src]="'http://localhost:8080/' + media.path" width="300" />
                <video *ngIf="isVideo(media.type)" [src]="'http://localhost:8080/' + media.path" controls width="300"></video>
            </div>
        </div>

        <div class="post-footer">
            <div class="post-actions-bar">
                <button class="action-btn like-btn" (click)="onReact(post.postUuid)">
                    <img src="/coffe-like.png" alt="Like" class="action-icon">
                    <span class="action-count">{{ post.likeCount }}</span>
                    <span class="action-label">Likes</span>
                </button>
                <button class="action-btn comment-btn" (click)="onComment(post.postUuid)">
                    <img src="/coffe-comment.png" alt="Comment" class="action-icon">
                    <span class="action-count">{{ post.commentCount }}</span>
                    <span class="action-label">Comments</span>
                </button>
            </div>

            <!-- Comments Section -->
            <div *ngIf="isCommenting" class="comments-section">
                <div class="comments-header">
                    <h3>Comments</h3>
                    <span class="comments-count">{{ post.commentCount }} comments</span>
                </div>

                <!-- Add Comment Form -->
                <div class="add-comment-form">
                    <div class="comment-input-wrapper">
                        <div class="user-avatar">
                            <img *ngIf="profileData?.profileImagePath"
                                [src]="'http://localhost:8080/' + profileData.profileImagePath" alt="Your avatar">
                            <div *ngIf="!profileData?.profileImagePath" class="avatar-placeholder">
                                {{ profileData.firstName.charAt(0) || '?' }}
                            </div>
                        </div>
                        <textarea name="comment" placeholder="Write a comment..." #commentData rows="3" maxlength="1000"
                            required></textarea>
                    </div>
                    <div class="comment-actions">
                        <button class="btn-secondary" (click)="onComment(post.postUuid)">Cancel</button>
                        <button class="btn-primary" type="submit"
                            (click)="onSubmitComment(commentData.value, comment?.postUuid); commentData.value = ''">
                            <span class="btn-icon">ðŸ“¤</span>
                            Post Comment
                        </button>
                    </div>
                </div>

                <!-- Comments List -->
                <div class="comments-list">
                    <!-- Instant Comments (Just Posted) -->
                    <div *ngFor="let instantComment of instantComments" class="comment-card new-comment">
                        <div class="comment-avatar" (click)="moveToProfile(instantComment.userUuid)">
                            <img [src]="'http://localhost:8080/' + instantComment.image" class="avatar-placeholder"
                                alt="">
                        </div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <span class="comment-author">{{ instantComment.username }}</span>
                                <span class="comment-badge">Just now</span>
                            </div>
                            <p class="comment-text">{{ instantComment.comment }}</p>
                            <div class="comment-meta">
                                <span class="comment-time">{{ instantComment.time | date:'short' }}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Existing Comments -->
                    <div *ngFor="let c of comment?.comments" class="comment-card">
                        <div class="comment-avatar" (click)="moveToProfile(c.userUuid)">
                            <img [src]="'http://localhost:8080/' + c?.imageProfile" class="avatar-placeholder" alt="">
                        </div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <span class="comment-author">{{ c?.userName }}</span>
                                <button *ngIf="myComment(c.userUuid)" class="btn-delete-comment"
                                        (click)="onDeleteComment(c.uuid)"
                                        title="Delete comment">
                                    <i class="bi bi-trash-fill"></i>
                                </button>
                            </div>
                            <p class="comment-text">{{ c?.comment }}</p>
                            <div class="comment-meta">
                                <span class="comment-time">{{ c?.createdAt | date:'short' }}</span>
                            </div>
                        </div>
                    </div>

                    <div *ngIf="comment?.comments?.length === 0 && instantComments?.length === 0" class="no-comments">
                        <span class="no-comments-icon">ðŸ’­</span>
                        <p>No comments yet. Be the first to comment!</p>
                    </div>
                </div>
            </div>
        </div>
        <div *ngIf="myPost(post.userUuid); else reportBlock" class="post-handler">
            <button class="btn-edit" (click)="onEdit(post.postUuid)">
                <i class="bi bi-pencil-fill"></i>
                Edit Post
            </button>

            <button class="btn-delete" (click)="onDelete(post.postUuid)">
                <i class="bi bi-trash-fill"></i>
                Delete Post
            </button>

        </div>

        <ng-template #reportBlock>
            <div class="post-handler">
                <!-- Report Post Button (for non-admin users) -->
                <button class="btn btn-warning btn-sm" *ngIf="!isAdmin" (click)="onReport()">
                    <i class="bi bi-flag-fill me-1"></i>
                    Report Post
                </button>

                <!-- Admin Hide/Unhide Post Button -->
                <button class="btn btn-secondary btn-sm" *ngIf="isAdmin" (click)="onPrepareAdminHidePost()">
                    <i class="bi me-1" [ngClass]="{
               'bi-eye-fill': post.status === 'HIDE',
               'bi-eye-slash-fill': post.status === 'EPOSED'}"></i>
                    <span *ngIf="post.status === 'HIDE'">Unhide Post</span>
                    <span *ngIf="post.status === 'EPOSED'">Hide Post</span>
                </button>

                <!-- Admin Delete Post Button -->
                <button class="btn btn-danger btn-sm" *ngIf="isAdmin" (click)="onPrepareAdminDeletePost()">
                    <i class="bi bi-trash-fill me-1"></i>
                    Delete Post
                </button>
            </div>

        </ng-template>

        <div *ngIf="reportAction" class="report-window">
            <div class="report-window-header">
                <h4>
                    <i class="bi bi-flag-fill me-1"></i>
                    Report This Post
                </h4>
                <button class="btn-close" (click)="onReport()"></button>
            </div>

            <textarea name="report" placeholder="Describe the problem..." #reportData></textarea>

            <div class="report-actions">
                <button class="btn btn-secondary btn-sm" (click)="onReport()">Cancel</button>
                <button class="btn btn-primary btn-sm" (click)="onPrepareSubmitReport(reportData.value)">
                    <i class="bi bi-send-fill me-1"></i>
                    Submit Report
                </button>
            </div>
        </div>

        <!-- Confirmation Popup -->
        <div *ngIf="showReportConfirmation" class="confirmation-overlay" (click)="onCancelReport()">
            <div class="confirmation-dialog" (click)="$event.stopPropagation()">
                <div class="confirmation-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path
                            d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.15.15 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.2.2 0 0 1-.054.06.1.1 0 0 1-.066.017H1.146a.1.1 0 0 1-.066-.017.2.2 0 0 1-.054-.06.18.18 0 0 1 .002-.183L7.884 2.073a.15.15 0 0 1 .054-.057m1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z" />
                        <path
                            d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z" />
                    </svg>
                </div>
                <h3 class="confirmation-title">Submit Report?</h3>
                <p class="confirmation-message">
                    Are you sure you want to submit this report? Our moderation team will be notified and will review
                    this
                    post for policy violations.
                </p>
                <div class="confirmation-actions">
                    <button class="btn-confirmation-cancel" (click)="onCancelReport()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                            <path
                                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
                        </svg>
                        Cancel
                    </button>
                    <button class="btn-confirmation-confirm" (click)="onConfirmReport()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4m.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2" />
                        </svg>
                        Yes, Submit Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Hide Post Confirmation Dialog -->
        <div *ngIf="showAdminHideConfirmation" class="confirmation-overlay" (click)="onCancelAdminHidePost()">
            <div class="confirmation-dialog" (click)="$event.stopPropagation()">
                <div class="confirmation-icon hide-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path
                            d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z" />
                        <path
                            d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829" />
                        <path
                            d="M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12z" />
                    </svg>
                </div>
                <h3 class="confirmation-title" *ngIf="post?.status === 'EPOSED'">Hide Post?</h3>
                <h3 class="confirmation-title" *ngIf="post?.status === 'HIDE'">Unhide Post?</h3>
                <p class="confirmation-message" *ngIf="post?.status === 'EPOSED'">
                    Are you sure you want to hide "<strong>{{post.title}}</strong>"? This will remove it from public
                    view.
                </p>
                <p class="confirmation-message" *ngIf="post?.status === 'HIDE'">
                    Are you sure you want to unhide "<strong>{{post.title}}</strong>"? This will make it visible to
                    users again.
                </p>
                <div class="confirmation-actions">
                    <button class="btn-confirmation-cancel" (click)="onCancelAdminHidePost()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                            <path
                                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
                        </svg>
                        Cancel
                    </button>
                    <button class="btn-confirmation-confirm btn-hide-confirm" (click)="onConfirmAdminHidePost()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7 7 0 0 0-2.79.588l.77.771A6 6 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13 13 0 0 1 14.828 8q-.086.13-.195.288c-.335.48-.83 1.12-1.465 1.755q-.247.248-.517.486z" />
                            <path
                                d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829" />
                            <path
                                d="M3.35 5.47q-.27.24-.518.487A13 13 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7 7 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.709zm10.296 8.884-12-12 .708-.708 12 12z" />
                        </svg>
                        <span *ngIf="post?.status === 'EPOSED'">Yes, Hide Post</span>
                        <span *ngIf="post?.status === 'HIDE'">Yes, Unhide Post</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Delete Post Confirmation Dialog -->
        <div *ngIf="showAdminDeleteConfirmation" class="confirmation-overlay" (click)="onCancelAdminDeletePost()">
            <div class="confirmation-dialog" (click)="$event.stopPropagation()">
                <div class="confirmation-icon delete-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor"
                        viewBox="0 0 16 16">
                        <path
                            d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" />
                        <path
                            d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z" />
                    </svg>
                </div>
                <h3 class="confirmation-title">Delete Post?</h3>
                <p class="confirmation-message" *ngIf="post">
                    Are you sure you want to permanently delete "<strong>{{post.title}}</strong>" by @{{post.userName}}?
                    This action cannot be undone.
                </p>
                <div class="confirmation-actions">
                    <button class="btn-confirmation-cancel" (click)="onCancelAdminDeletePost()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                            <path
                                d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708" />
                        </svg>
                        Cancel
                    </button>
                    <button class="btn-confirmation-confirm btn-delete-confirm" (click)="onConfirmAdminDeletePost()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            viewBox="0 0 16 16">
                            <path
                                d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" />
                            <path
                                d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z" />
                        </svg>
                        Yes, Delete Post
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>