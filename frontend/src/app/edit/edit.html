<div class="edit-container" *ngIf="post && isAuthorized">
    <!-- Multi-type Toast Message -->
    <div *ngIf="toastMessage" class="toast-message" [ngClass]="{
        'toast-success': toastMessage.type === 'success',
        'toast-error': toastMessage.type === 'error',
        'toast-warning': toastMessage.type === 'warning'}">
        <i *ngIf="toastMessage.type === 'success'" class="bi bi-check-circle-fill text-success fs-5"></i>
        <i *ngIf="toastMessage.type === 'error'" class="bi bi-x-circle-fill text-danger fs-5"></i>
        <i *ngIf="toastMessage.type === 'warning'" class="bi bi-exclamation-triangle-fill text-warning fs-5"></i>
        <span class="ms-2">{{ toastMessage.text }}</span>
        <button class="close-toast-btn btn btn-link p-0 ms-2" (click)="toastMessage = null">
            <i class="bi bi-x-lg text-secondary"></i>
        </button>
    </div>

    <div class="edit-card">
        <div class="edit-header">
            <h1>Edit Post</h1>
            <p>Update your post content and media</p>
        </div>

        <form class="edit-form">
            <!-- Title Input -->
            <div class="form-group">
                <label for="postTitle" class="form-label">
                    <i class="bi bi-pencil-square"></i> Post Title
                </label>
                <input id="postTitle" type="text" [(ngModel)]="post.title" name="title"
                    placeholder="Enter your post title" maxlength="200" required class="form-input" />
                <div class="char-count-hint">
                    <span class="char-count">{{ (post.title.length || 0) }}/200</span>
                </div>
            </div>

            <!-- Content Textarea -->
            <div class="form-group">
                <label for="postContent" class="form-label">
                    <i class="bi bi-file-text"></i> Post Content
                </label>
                <textarea id="postContent" [(ngModel)]="post.content" name="content"
                    placeholder="Write your post content here..." maxlength="10000" required rows="8"
                    class="form-textarea"></textarea>
                <div class="char-count-hint">
                    <span class="char-count">{{ (post.content.length || 0) }}/10000</span>
                </div>
            </div>

            <!-- Existing Media Section -->
            <div class="form-group" *ngIf="post?.mediaPaths && post.mediaPaths.length > 0">
                <label class="form-label">
                    <i class="bi bi-images"></i> Current Media
                </label>
                <div class="media-grid">
                    <div *ngFor="let media of post?.mediaPaths" class="media-item">
                        <img *ngIf="isImage(media.type)" [src]="'http://localhost:8080/' + media.path" alt="Post media" />
                        <video *ngIf="isVideo(media.type)" [src]="'http://localhost:8080/' + media.path" controls></video>
                        <button type="button" class="remove-media-btn" (click)="deleteMedia(media.path)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- File Input -->
            <div class="form-group">
                <label for="fileInput" class="form-label">
                    <i class="bi bi-cloud-upload"></i> Add More Media
                </label>
                <div class="file-input-wrapper">
                    <input id="fileInput" type="file" (change)="onFileSelected($event)" multiple
                        accept="image/*,video/*" class="file-input">
                    <label for="fileInput" class="file-input-label">
                        <i class="bi bi-plus-circle"></i>
                        <span>Choose Files</span>
                    </label>
                    <span *ngIf="selectedFiles.length > 0" class="file-count">
                        {{selectedFiles.length}} new file(s) selected
                    </span>
                </div>
            </div>

            <!-- New Media Preview Section -->
            <div class="form-group" *ngIf="previewUrls.length > 0">
                <label class="form-label">
                    <i class="bi bi-eye"></i> New Media Preview
                </label>
                <div class="media-grid">
                    <div *ngFor="let url of previewUrls; index as i" class="media-item">
                        <img *ngIf="url.url.startsWith('blob:') && url.fileType.startsWith('image')" [src]="url.url" alt="Preview" />
                        <video *ngIf="url.url.startsWith('blob:') && url.fileType.startsWith('video')" [src]="url.url" controls></video>
                        <button type="button" class="remove-media-btn" (click)="deleteFileSelected(i)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Error Message -->
            <div class="message-err" *ngIf="message">
                {{message}}
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="button" class="btn btn-cancel" (click)="navigate.navigate([''])">
                    <i class="bi bi-x-circle"></i> Cancel
                </button>
                <button type="button" class="btn btn-save" (click)="onSave(post)">
                    <i class="bi bi-check-circle"></i> Save Changes
                </button>
            </div>
        </form>
    </div>
</div>