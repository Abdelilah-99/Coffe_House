@if(post && isAuthorized) {
<div class="edit-container">
    <div class="edit-card">
        <div class="edit-header">
            <h1>Edit Post</h1>
            <p>Update your post content and media</p>
        </div>

        <form class="edit-form">
            <!-- Title Input -->
            <div class="form-group">
                <label for="postTitle" class="form-label">
                    <i class="bi bi-pencil-square"></i> Post Title
                </label>
                <input id="postTitle" type="text" [(ngModel)]="post.title" name="title"
                    placeholder="Enter your post title" maxlength="200" required class="form-input" />
                <div class="char-count-hint">
                    <span class="char-count">{{ (post.title.length || 0) }}/200</span>
                </div>
            </div>

            <!-- Content Textarea -->
            <div class="form-group">
                <label for="postContent" class="form-label">
                    <i class="bi bi-file-text"></i> Post Content
                </label>
                <textarea id="postContent" [(ngModel)]="post.content" name="content"
                    placeholder="Write your post content here..." maxlength="10000" required rows="8"
                    class="form-textarea"></textarea>
                <div class="char-count-hint">
                    <span class="char-count">{{ (post.content.length || 0) }}/10000</span>
                </div>
            </div>

            <!-- Existing Media Section -->
            @if(post.mediaPaths && post.mediaPaths.length > 0) {
            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-images"></i> Current Media
                </label>
                <div class="media-grid">
                    @for(media of post.mediaPaths; track media) {
                    <div class="media-item">
                        @if(isImage(media.type)) {
                        <img [src]="'http://localhost:8080/' + media.path" alt="Post media" />
                        }
                        @if(isVideo(media.type)) {
                        <video [src]="'http://localhost:8080/' + media.path" controls></video>
                        }
                        <button type="button" class="remove-media-btn" (click)="deleteMedia(media.path)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                    }
                </div>
            </div>
            }

            <!-- File Input -->
            <div class="form-group">
                <label for="fileInput" class="form-label">
                    <i class="bi bi-cloud-upload"></i> Add More Media
                </label>
                <div class="file-input-wrapper">
                    <input id="fileInput" type="file" (change)="onFileSelected($event)" multiple
                        accept="image/*,video/*" class="file-input">
                    <label for="fileInput" class="file-input-label">
                        <i class="bi bi-plus-circle"></i>
                        <span>Choose Files</span>
                    </label>
                    @if(selectedFiles.length > 0) {
                    <span class="file-count">
                        {{selectedFiles.length}} new file(s) selected
                    </span>
                    }
                </div>
            </div>

            <!-- New Media Preview Section -->
            @if(previewUrls.length > 0) {
            <div class="form-group">
                <label class="form-label">
                    <i class="bi bi-eye"></i> New Media Preview
                </label>
                <div class="media-grid">
                    @for(url of previewUrls; track $index) {
                    <div class="media-item">
                        @if(url.url.startsWith('blob:') && url.fileType.startsWith('image')) {
                        <img [src]="url.url" alt="Preview" />
                        }
                        @if(url.url.startsWith('blob:') && url.fileType.startsWith('video')) {
                        <video [src]="url.url" controls></video>
                        }
                        <button type="button" class="remove-media-btn" (click)="deleteFileSelected($index)">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                    }
                </div>
            </div>
            }

            <!-- Error Message -->
            @if(message) {
            <div class="message-err">
                {{message}}
            </div>
            }

            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="button" class="btn btn-cancel" (click)="navigate.navigate([''])">
                    <i class="bi bi-x-circle"></i> Cancel
                </button>
                <button type="button" class="btn btn-save" (click)="onSave(post)">
                    <i class="bi bi-check-circle"></i> Save Changes
                </button>
            </div>
        </form>
    </div>
</div>
}
